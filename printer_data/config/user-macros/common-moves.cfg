[gcode_macro MOVE_TO_CENTER]
gcode: 
  {% set max_y = printer.configfile.config["stepper_y"]["position_max"]|float %}
  {% set max_x = printer.configfile.config["stepper_x"]["position_max"]|float %}
  CONDHOME
  G91
  G1 Z10 F9000
  G90 ; absolute mode
  G0 X{max_x//2} Y{max_y//2} F18000
  
[gcode_macro CONDHOME]
gcode:
    {% if printer.toolhead.homed_axes != "xyz" %}
        G28
    {% endif %}

[gcode_macro UNSAFE_LOWER]
description: Lower the bed 50mm without homing
gcode:
  G90
  SET_KINEMATIC_POSITION Z=50
  G0 Z0 F2000

[gcode_macro UNSAFE_RAISE]
description: Raise the bed 50mm without homing
gcode:
  G90
  SET_KINEMATIC_POSITION X=175 Y=175 Z=0
  G0 Z50 F2000

[gcode_macro PROBE_CAL_SEQ]
gcode:
  G28
  QUAD_GANTRY_LEVEL
  G28 Z
  MOVE_TO_CENTER
  PROBE_CALIBRATE

[gcode_macro UTOOL_ALIGN_TEST]
gcode:
    {% set curpos = printer.gcode_move.gcode_position %}
    INITIALIZE_TOOLCHANGER # Detect current tool
    SET_GCODE_OFFSET X=0 Y=0 Z=0
    SET_TOOL_PARAMETER PARAMETER='params_park_x' VALUE={curpos[0]}
    SET_TOOL_PARAMETER PARAMETER='params_park_y' VALUE={curpos[1]}
    SET_TOOL_PARAMETER PARAMETER='params_park_z' VALUE={curpos[2]}
    TEST_TOOL_DOCKING RESTORE_AXIS=XYZ
